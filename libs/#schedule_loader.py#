import sys, os
sys.path.append(os.path.abspath('..'))

import psycopg2
import csv
from stats.models import PlayerGameStats, Game, Team, Player, Week
from datetime import datetime

class ScheduleLoader:
    def __init__(self, host, user, passwd, db):
        self.host=host
        self.user=user
        self.passwd=passwd
        self.db=db
    
    def load_file(self, filename):
        f = open(filename, 'rU')
        reader = csv.reader(f)
        for row in reader:
            try:
                int(row[0])
            except:
                continue

            if len(row) <= 7:
                weeknum = row[0]
                date = row[2]
                away_team = row[3]
                home_team = row[5]
                time = row[6]
                year = 2012
            else:
                weeknum = row[0]
                date = row[2]
                away_team = row[4]
                ateam = 
            ateam = Team.objects.get(name=Team.TEAM_MAP[away_team])
            hteam = Team.objects.get(name=Team.TEAM_MAP[home_team])
            dt = datetime.strptime(date + " " + str(year) + " " + time, "%B %d %Y %I:%M %p")
            week, wcreated = Week.objects.get_or_create(num=weeknum)
            Game.objects.get_or_create(week=week, datetime=dt, away_team=ateam,home_team=hteam)
        f.close()

